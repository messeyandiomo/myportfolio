{"ast":null,"code":"// Copyright 2012 Timothy J Fontaine <tjfontaine@gmail.com>\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE\n\n'use strict';\n\nvar net = require('net'),\n  util = require('util'),\n  EventEmitter = require('events').EventEmitter,\n  Packet = require('./packet'),\n  consts = require('native-dns-packet').consts,\n  UDPSocket = require('./utils').UDPSocket,\n  TCPSocket = require('./utils').TCPSocket;\nvar debug = function () {\n  //var args = Array.prototype.slice.call(arguments);\n  //console.log.apply(this, ['pending', Date.now().toString()].concat(args));\n};\nvar SocketQueue = function (socket, server) {\n  this._active = {};\n  this._active_count = 0;\n  this._pending = [];\n  debug('created', server);\n  this._server = server;\n  this._socket = socket;\n  this._socket.on('ready', this._onlisten.bind(this));\n  this._socket.on('message', this._onmessage.bind(this));\n  this._socket.on('close', this._onclose.bind(this));\n  this._socket.bind(server);\n  this._refd = true;\n};\nutil.inherits(SocketQueue, EventEmitter);\nSocketQueue.prototype.send = function (request) {\n  debug('added', request.question);\n  this._pending.push(request);\n  this._fill();\n};\nSocketQueue.prototype.remove = function (request) {\n  var req = this._active[request.id];\n  var idx = this._pending.indexOf(request);\n  if (req) {\n    delete this._active[request.id];\n    this._active_count -= 1;\n    this._fill();\n  }\n  if (idx > -1) this._pending.splice(idx, 1);\n  this._unref();\n};\nSocketQueue.prototype.close = function () {\n  debug('closing', this._server);\n  this._socket.close();\n  this._socket = undefined;\n  this.emit('close');\n};\nSocketQueue.prototype._fill = function () {\n  debug('pre fill, active:', this._active_count, 'pending:', this._pending.length);\n  while (this._listening && this._pending.length && this._active_count < 100) {\n    this._dequeue();\n  }\n  debug('post fill, active:', this._active_count, 'pending:', this._pending.length);\n};\nvar random_integer = function () {\n  return Math.floor(Math.random() * 50000 + 1);\n};\nSocketQueue.prototype._dequeue = function () {\n  var req = this._pending.pop();\n  var id, packet, dnssocket;\n  if (req) {\n    id = random_integer();\n    while (this._active[id]) id = random_integer();\n    debug('sending', req.question, id);\n    req.id = id;\n    this._active[id] = req;\n    this._active_count += 1;\n    try {\n      packet = new Packet(this._socket.remote(req.server));\n      packet.header.id = id;\n      packet.header.rd = 1;\n      if (req.try_edns) {\n        packet.edns_version = 0;\n        //TODO when we support dnssec\n        //packet.do = 1\n      }\n\n      packet.question.push(req.question);\n      packet.send();\n      this._ref();\n    } catch (e) {\n      req.error(e);\n    }\n  }\n};\nSocketQueue.prototype._onmessage = function (msg, remote) {\n  var req;\n  debug('got a message', this._server);\n  try {\n    var packet = Packet.parse(msg, remote);\n    req = this._active[packet.header.id];\n    debug('associated message', packet.header.id);\n  } catch (e) {\n    debug('error parsing packet', e);\n  }\n  if (req) {\n    delete this._active[packet.header.id];\n    this._active_count -= 1;\n    req.handle(null, packet);\n    this._fill();\n  }\n  this._unref();\n};\nSocketQueue.prototype._unref = function () {\n  var self = this;\n  this._refd = false;\n  if (this._active_count <= 0) {\n    if (this._socket.unref) {\n      debug('unrefd socket');\n      this._socket.unref();\n    } else if (!this._timer) {\n      this._timer = setTimeout(function () {\n        self.close();\n      }, 300);\n    }\n  }\n};\nSocketQueue.prototype._ref = function () {\n  this._refd = true;\n  if (this._socket.ref) {\n    debug('refd socket');\n    this._socket.ref();\n  } else if (this._timer) {\n    clearTimeout(this._timer);\n    this._timer = null;\n  }\n};\nSocketQueue.prototype._onlisten = function () {\n  this._unref();\n  this._listening = true;\n  this._fill();\n};\nSocketQueue.prototype._onclose = function () {\n  var req,\n    err,\n    self = this;\n  debug('socket closed', this);\n  this._listening = false;\n  err = new Error('getHostByName ' + consts.TIMEOUT);\n  err.errno = consts.TIMEOUT;\n  while (this._pending.length) {\n    req = this._pending.pop();\n    req.error(err);\n  }\n  Object.keys(this._active).forEach(function (key) {\n    var req = self._active[key];\n    req.error(err);\n    delete self._active[key];\n    self._active_count -= 1;\n  });\n};\nvar serverHash = function (server) {\n  if (server.type === 'tcp') return server.address + ':' + server.port;else return 'udp' + net.isIP(server.address);\n};\nvar _sockets = {};\nexports.send = function (request) {\n  var hash = serverHash(request.server);\n  var socket = _sockets[hash];\n  if (!socket) {\n    switch (hash) {\n      case 'udp4':\n      case 'udp6':\n        socket = new SocketQueue(new UDPSocket(), hash);\n        break;\n      default:\n        socket = new SocketQueue(new TCPSocket(), request.server);\n        break;\n    }\n    socket.on('close', function () {\n      delete _sockets[hash];\n    });\n    _sockets[hash] = socket;\n  }\n  socket.send(request);\n};\nexports.remove = function (request) {\n  var hash = serverHash(request.server);\n  var socket = _sockets[hash];\n  if (socket) {\n    socket.remove(request);\n  }\n};","map":{"version":3,"names":["net","require","util","EventEmitter","Packet","consts","UDPSocket","TCPSocket","debug","SocketQueue","socket","server","_active","_active_count","_pending","_server","_socket","on","_onlisten","bind","_onmessage","_onclose","_refd","inherits","prototype","send","request","question","push","_fill","remove","req","id","idx","indexOf","splice","_unref","close","undefined","emit","length","_listening","_dequeue","random_integer","Math","floor","random","pop","packet","dnssocket","remote","header","rd","try_edns","edns_version","_ref","e","error","msg","parse","handle","self","unref","_timer","setTimeout","ref","clearTimeout","err","Error","TIMEOUT","errno","Object","keys","forEach","key","serverHash","type","address","port","isIP","_sockets","exports","hash"],"sources":["/home/bilal/ReactLabs/myportfolio/node_modules/native-dns/lib/pending.js"],"sourcesContent":["// Copyright 2012 Timothy J Fontaine <tjfontaine@gmail.com>\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE\n\n'use strict';\n\nvar net = require('net'),\n    util = require('util'),\n    EventEmitter = require('events').EventEmitter,\n    Packet = require('./packet'),\n    consts = require('native-dns-packet').consts,\n    UDPSocket = require('./utils').UDPSocket,\n    TCPSocket = require('./utils').TCPSocket;\n\nvar debug = function() {\n  //var args = Array.prototype.slice.call(arguments);\n  //console.log.apply(this, ['pending', Date.now().toString()].concat(args));\n};\n\nvar SocketQueue = function(socket, server) {\n  this._active = {};\n  this._active_count = 0;\n  this._pending = [];\n\n  debug('created', server);\n\n  this._server = server;\n\n  this._socket = socket;\n  this._socket.on('ready', this._onlisten.bind(this));\n  this._socket.on('message', this._onmessage.bind(this));\n  this._socket.on('close', this._onclose.bind(this));\n  this._socket.bind(server);\n\n  this._refd = true;\n};\nutil.inherits(SocketQueue, EventEmitter);\n\nSocketQueue.prototype.send = function(request) {\n  debug('added', request.question);\n  this._pending.push(request);\n  this._fill();\n};\n\nSocketQueue.prototype.remove = function(request) {\n  var req = this._active[request.id];\n  var idx = this._pending.indexOf(request);\n\n  if (req) {\n    delete this._active[request.id];\n    this._active_count -= 1;\n    this._fill();\n  }\n\n  if (idx > -1)\n    this._pending.splice(idx, 1);\n\n  this._unref();\n};\n\nSocketQueue.prototype.close = function() {\n  debug('closing', this._server);\n  this._socket.close();\n  this._socket = undefined;\n  this.emit('close');\n};\n\nSocketQueue.prototype._fill = function() {\n  debug('pre fill, active:', this._active_count, 'pending:',\n        this._pending.length);\n\n  while (this._listening && this._pending.length &&\n         this._active_count < 100) {\n    this._dequeue();\n  }\n\n  debug('post fill, active:', this._active_count, 'pending:',\n        this._pending.length);\n};\n\nvar random_integer = function() {\n  return Math.floor(Math.random() * 50000 + 1);\n};\n\nSocketQueue.prototype._dequeue = function() {\n  var req = this._pending.pop();\n  var id, packet, dnssocket;\n\n  if (req) {\n    id = random_integer();\n\n    while (this._active[id])\n      id = random_integer();\n\n    debug('sending', req.question, id);\n\n    req.id = id;\n    this._active[id] = req;\n    this._active_count += 1;\n\n    try {\n      packet = new Packet(this._socket.remote(req.server));\n      packet.header.id = id;\n      packet.header.rd = 1;\n\n      if (req.try_edns) {\n        packet.edns_version = 0;\n        //TODO when we support dnssec\n        //packet.do = 1\n      }\n\n      packet.question.push(req.question);\n      packet.send();\n\n      this._ref();\n    } catch (e) {\n      req.error(e);\n    }\n  }\n};\n\nSocketQueue.prototype._onmessage = function(msg, remote) {\n  var req;\n\n  debug('got a message', this._server);\n\n  try {\n    var packet = Packet.parse(msg, remote);\n    req = this._active[packet.header.id];\n    debug('associated message', packet.header.id);\n  } catch (e) {\n    debug('error parsing packet', e);\n  }\n\n  if (req) {\n    delete this._active[packet.header.id];\n    this._active_count -= 1;\n    req.handle(null, packet);\n    this._fill();\n  }\n\n  this._unref();\n};\n\nSocketQueue.prototype._unref = function() {\n  var self = this;\n  this._refd = false;\n\n  if (this._active_count <= 0) {\n    if (this._socket.unref) {\n      debug('unrefd socket');\n      this._socket.unref();\n    } else if (!this._timer) {\n      this._timer = setTimeout(function() {\n        self.close();\n      }, 300);\n    }\n  }\n};\n\nSocketQueue.prototype._ref = function() {\n  this._refd = true;\n  if (this._socket.ref) {\n    debug('refd socket');\n    this._socket.ref();\n  } else if (this._timer) {\n    clearTimeout(this._timer);\n    this._timer = null;\n  }\n};\n\nSocketQueue.prototype._onlisten = function() {\n  this._unref();\n  this._listening = true;\n  this._fill();\n};\n\nSocketQueue.prototype._onclose = function() {\n  var req, err, self = this;\n\n  debug('socket closed', this);\n\n  this._listening = false;\n\n  err = new Error('getHostByName ' + consts.TIMEOUT);\n  err.errno = consts.TIMEOUT;\n\n  while (this._pending.length) {\n    req = this._pending.pop();\n    req.error(err);\n  }\n\n  Object.keys(this._active).forEach(function(key) {\n    var req = self._active[key];\n    req.error(err);\n    delete self._active[key];\n    self._active_count -= 1;\n  });\n};\n\nvar serverHash = function(server) {\n  if (server.type === 'tcp')\n    return server.address + ':' + server.port;\n  else\n    return 'udp' + net.isIP(server.address);\n};\n\nvar _sockets = {};\n\nexports.send = function(request) {\n  var hash = serverHash(request.server);\n  var socket = _sockets[hash];\n\n  if (!socket) {\n    switch (hash) {\n      case 'udp4':\n      case 'udp6':\n        socket = new SocketQueue(new UDPSocket(), hash);\n        break;\n      default:\n        socket = new SocketQueue(new TCPSocket(), request.server);\n        break;\n    }\n\n    socket.on('close', function() {\n      delete _sockets[hash];\n    });\n\n    _sockets[hash] = socket;\n  }\n\n  socket.send(request);\n};\n\nexports.remove = function(request) {\n  var hash = serverHash(request.server);\n  var socket = _sockets[hash];\n  if (socket) {\n    socket.remove(request);\n  }\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}