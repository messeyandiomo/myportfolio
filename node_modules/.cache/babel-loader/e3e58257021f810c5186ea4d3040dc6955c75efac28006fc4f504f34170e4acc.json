{"ast":null,"code":"// Copyright 2011 Timothy J Fontaine <tjfontaine@gmail.com>\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE\n\n'use strict';\n\nvar dgram = require('dgram'),\n  EventEmitter = require('events').EventEmitter,\n  net = require('net'),\n  util = require('util'),\n  UDPSocket = require('./utils').UDPSocket,\n  TCPSocket = require('./utils').TCPSocket,\n  Packet = require('./packet');\nvar Server = function (opts) {\n  var self = this;\n  this._socket.on('listening', function () {\n    self.emit('listening');\n  });\n  this._socket.on('close', function () {\n    self.emit('close');\n  });\n  this._socket.on('error', function (err) {\n    self.emit('socketError', err, self._socket);\n  });\n};\nutil.inherits(Server, EventEmitter);\nServer.prototype.close = function () {\n  this._socket.close();\n};\nServer.prototype.address = function () {\n  return this._socket.address();\n};\nServer.prototype.handleMessage = function (msg, remote, address) {\n  var request,\n    response = new Packet(remote);\n  try {\n    request = Packet.parse(msg, remote);\n    request.address = address;\n    response.header.id = request.header.id;\n    response.header.qr = 1;\n    response.question = request.question;\n    this.emit('request', request, response);\n  } catch (e) {\n    this.emit('error', e, msg, response);\n  }\n};\nvar UDPServer = function (opts) {\n  var self = this;\n  this._socket = dgram.createSocket(opts.dgram_type || 'udp4');\n  this._socket.on('message', function (msg, remote) {\n    self.handleMessage(msg, new UDPSocket(self._socket, remote), remote);\n  });\n  Server.call(this, opts);\n};\nutil.inherits(UDPServer, Server);\nUDPServer.prototype.serve = function (port, address) {\n  this._socket.bind(port, address);\n};\nvar TCPServer = function (opts) {\n  var self = this;\n  this._socket = net.createServer(function (client) {\n    var tcp = new TCPSocket(client);\n    var address = client.address();\n    tcp.on('message', function (msg, remote) {\n      self.handleMessage(msg, tcp, address);\n    });\n    tcp.catchMessages();\n  });\n  Server.call(this, opts);\n};\nutil.inherits(TCPServer, Server);\nTCPServer.prototype.serve = function (port, address) {\n  this._socket.listen(port, address);\n};\nexports.createServer = function (opts) {\n  return new UDPServer(opts || {});\n};\nexports.createUDPServer = function (opts) {\n  return exports.createServer(opts);\n};\nexports.createTCPServer = function (opts) {\n  return new TCPServer(opts || {});\n};","map":{"version":3,"names":["dgram","require","EventEmitter","net","util","UDPSocket","TCPSocket","Packet","Server","opts","self","_socket","on","emit","err","inherits","prototype","close","address","handleMessage","msg","remote","request","response","parse","header","id","qr","question","e","UDPServer","createSocket","dgram_type","call","serve","port","bind","TCPServer","createServer","client","tcp","catchMessages","listen","exports","createUDPServer","createTCPServer"],"sources":["/home/bilal/ReactLabs/myportfolio/node_modules/native-dns/lib/server.js"],"sourcesContent":["// Copyright 2011 Timothy J Fontaine <tjfontaine@gmail.com>\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE\n\n'use strict';\n\nvar dgram = require('dgram'),\n    EventEmitter = require('events').EventEmitter,\n    net = require('net'),\n    util = require('util'),\n    UDPSocket = require('./utils').UDPSocket,\n    TCPSocket = require('./utils').TCPSocket,\n    Packet = require('./packet');\n\nvar Server = function(opts) {\n  var self = this;\n\n  this._socket.on('listening', function() {\n    self.emit('listening');\n  });\n\n  this._socket.on('close', function() {\n    self.emit('close');\n  });\n\n  this._socket.on('error', function(err) {\n    self.emit('socketError', err, self._socket);\n  });\n};\nutil.inherits(Server, EventEmitter);\n\nServer.prototype.close = function() {\n  this._socket.close();\n};\n\nServer.prototype.address = function() {\n  return this._socket.address();\n};\n\nServer.prototype.handleMessage = function(msg, remote, address) {\n  var request, response = new Packet(remote);\n\n  try {\n    request = Packet.parse(msg, remote);\n\n    request.address = address;\n\n    response.header.id = request.header.id;\n    response.header.qr = 1;\n    response.question = request.question;\n\n    this.emit('request', request, response);\n  } catch (e) {\n    this.emit('error', e, msg, response);\n  }\n};\n\nvar UDPServer = function(opts) {\n  var self = this;\n\n  this._socket = dgram.createSocket(opts.dgram_type || 'udp4');\n\n  this._socket.on('message', function(msg, remote) {\n    self.handleMessage(msg, new UDPSocket(self._socket, remote), remote);\n  });\n\n  Server.call(this, opts);\n};\nutil.inherits(UDPServer, Server);\n\nUDPServer.prototype.serve = function(port, address) {\n  this._socket.bind(port, address);\n};\n\nvar TCPServer = function(opts) {\n  var self = this;\n\n  this._socket = net.createServer(function(client) {\n    var tcp = new TCPSocket(client);\n    var address = client.address();\n    tcp.on('message', function(msg, remote) {\n      self.handleMessage(msg, tcp, address);\n    });\n    tcp.catchMessages();\n  });\n\n  Server.call(this, opts);\n};\nutil.inherits(TCPServer, Server);\n\nTCPServer.prototype.serve = function(port, address) {\n  this._socket.listen(port, address);\n};\n\nexports.createServer = function(opts) {\n  return new UDPServer(opts || {});\n};\n\nexports.createUDPServer = function(opts) {\n  return exports.createServer(opts);\n};\n\nexports.createTCPServer = function(opts) {\n  return new TCPServer(opts || {});\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}